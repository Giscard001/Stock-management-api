
openapi: 3.0.0
info:
  title: School Management System API
  description: Comprehensive API for the School Management System.
  version: 1.0.0
servers:
  - url: http://localhost:3000/api
    description: Local Development Server
components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
  schemas:
    User:
      type: object
      properties:
        id:
          type: string
        firstName:
          type: string
        lastName:
          type: string
        email:
          type: string
        role:
          type: string
          enum: [ADMIN, PROFESSEUR, CENSEUR, PROVISEUR, SECRETAIRE, PARENT, ELEVE, USER]
    LoginRequest:
      type: object
      required:
        - email
        - password
      properties:
        email:
          type: string
        password:
          type: string
    RegisterRequest:
      type: object
      required:
        - firstName
        - lastName
        - email
        - password
      properties:
        firstName:
          type: string
        lastName:
          type: string
        email:
          type: string
        password:
          type: string
        role:
          type: string
          description: Optional, defaults to USER. Allowed- USER, PARENT.
security:
  - bearerAuth: []
paths:
  /auth/login:
    post:
      tags: [Auth]
      summary: Login user
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginRequest'
      responses:
        200:
          description: Successful login
  /auth/register:
    post:
      tags: [Auth]
      summary: Register new user
      requestBody:
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                firstName:
                    type: string
                lastName:
                    type: string
                email:
                    type: string
                password:
                    type: string
                role:
                    type: string
                profilePhoto:
                    type: string
                    format: binary
      responses:
        201:
          description: User created
  /auth/setup-admin:
    post:
      tags: [Auth]
      summary: Setup initial Admin (One-time)
      requestBody:
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                firstName: { type: string }
                lastName: { type: string }
                email: { type: string }
                password: { type: string }
                profilePhoto: { type: string, format: binary }
      responses:
        201:
          description: Admin created
  /users/profile:
    get:
      tags: [Auth]
      summary: Get current user profile
      responses:
        200:
          description: User profile
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
  /users:
    get:
      tags: [Admin - User Mgmt]
      summary: Get all users
      security:
        - bearerAuth: []
      responses:
        200:
          description: List of users
  /users/{id}/role:
    put:
      tags: [Admin - User Mgmt]
      summary: Update user role
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                role:
                  type: string
      responses:
        200:
          description: User updated
  /users/{id}:
    delete:
      tags: [Admin - User Mgmt]
      summary: Delete user
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      responses:
        200:
          description: User deleted
  /users/admin/logs:
    get:
      tags: [Admin - System]
      summary: Get System Logs
      responses:
        200:
          description: System logs
  /academic/structure:
    get:
      tags: [Academic]
      summary: Get academic structure (streams, levels, subjects)
      responses:
        200:
          description: Academic structure
  /academic/levels:
    post:
      tags: [Academic]
      summary: Add Level to Stream
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                streamId: { type: string }
                name: { type: string }
                id: { type: string }
      responses:
        201:
          description: Level added
  /academic/subjects:
    post:
      tags: [Academic]
      summary: Add Subject to Level
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                streamId: { type: string }
                levelId: { type: string }
                name: { type: string }
                coefficient: { type: number }
      responses:
        201:
          description: Subject added
  /academic/classes:
    get:
      tags: [Academic]
      summary: Get all classes
      responses:
        200:
          description: List of classes
    post:
      tags: [Academic]
      summary: Create a class
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                name: { type: string }
                levelId: { type: string }
                streamId: { type: string }
                mainTeacherId: { type: string }
      responses:
        201:
          description: Class created
  /academic/courses:
    post:
      tags: [Academic]
      summary: Assign Teacher to Subject/Class (Create Course)
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                classId: { type: string }
                teacherId: { type: string }
                subjectName: { type: string }
                streamId: { type: string }
                levelId: { type: string }
      responses:
        201:
          description: Course created
  /academic/courses/teacher/{teacherId}:
    get:
      tags: [Academic]
      summary: Get courses for a teacher
      parameters:
        - in: path
          name: teacherId
          required: true
          schema:
            type: string
      responses:
        200:
          description: List of courses
  /academic/classes/{classId}/students:
    post:
      tags: [Academic]
      summary: Add student to class
      parameters:
        - in: path
          name: classId
          required: true
          schema:
            type: string
      requestBody:
        content:
            application/json:
                schema:
                    type: object
                    properties:
                        studentId: { type: string }
      responses:
        200:
            description: Student added
  /professor/assignments:
    post:
      tags: [Professor]
      summary: Create Assignment
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                courseId: { type: string }
                title: { type: string }
                type: { type: string }
                date: { type: string }
                maxScore: { type: number }
      responses:
        201:
          description: Assignment created
  /professor/grades:
    post:
      tags: [Professor]
      summary: Enter Grade
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                assignmentId: { type: string }
                studentId: { type: string }
                value: { type: number }
                comment: { type: string }
      responses:
        200:
          description: Grade saved
  /professor/courses/{courseId}/assignments:
    get:
      tags: [Professor]
      summary: Get assignments for a course
      parameters:
        - in: path
          name: courseId
          required: true
          schema:
            type: string
      responses:
        200:
          description: List of assignments
  /professor/assignments/{assignmentId}/grades:
    get:
      tags: [Professor]
      summary: Get grades for an assignment
      parameters:
        - in: path
          name: assignmentId
          required: true
          schema:
            type: string
      responses:
        200:
          description: List of grades
  /censeur/grades:
    get:
      tags: [Censeur]
      summary: Get all grades (filterable)
      responses:
        200:
          description: List of grades
  /censeur/grades/{id}/validate:
    put:
      tags: [Censeur]
      summary: Validate a grade
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      responses:
        200:
          description: Grade validated
  /censeur/grades/{id}:
    put:
      tags: [Censeur]
      summary: Modify a grade
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                value: { type: number }
                comment: { type: string }
      responses:
        200:
          description: Grade modified
  /proviseur/dashboard:
    get:
      tags: [Proviseur]
      summary: Get Proviseur Dashboard
      responses:
        200:
          description: Dashboard stats
  /proviseur/validate-bulletin:
    post:
      tags: [Proviseur]
      summary: Generate and Validate Bulletin
      requestBody:
        content:
            application/json:
                schema:
                    type: object
                    properties:
                        studentId: { type: string }
                        period: { type: string }
      responses:
        201:
            description: Bulletin validated
  /proviseur/unlock:
    patch:
      tags: [Proviseur]
      summary: Unlock a bulletin
      requestBody:
          content:
             application/json:
                schema:
                   type: object
                   properties:
                      studentId: { type: string }
                      period: { type: string }
      responses:
        200:
           description: Bulletin unlocked
  /proviseur/bulletins:
    get:
      tags: [Proviseur]
      summary: List all bulletins
      responses:
        200:
           description: List of bulletins
  /bulletins/student/{studentId}:
    get:
      tags: [Public/Portal]
      summary: Get Student Bulletin
      parameters:
        - in: path
          name: studentId
          required: true
          schema:
            type: string
        - in: query
          name: period
          schema:
            type: string
      responses:
        200:
            description: Bulletin data
  /secretary/import-students:
    post:
      tags: [Secretary]
      summary: Import Students from Excel
      requestBody:
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                file:
                  type: string
                  format: binary
      responses:
        200:
          description: Import result
  /secretary/bulletins/{studentId}/pdf:
    get:
      tags: [Secretary]
      summary: Download Bulletin PDF (Individual)
      parameters:
        - in: path
          name: studentId
          required: true
          schema:
             type: string
        - in: query
          name: period
          schema:
             type: string
      responses:
        200:
            description: PDF File
  /secretary/bulletins:
    get:
      tags: [Secretary]
      summary: List all bulletins
      responses:
        200:
           description: List
  /secretary/archive:
    get:
       tags: [Secretary]
       summary: Get Archives
       responses:
         200:
            description: Archives
  /portal/link-child:
    post:
      tags: [Portal (Parent)]
      summary: Link Child (Parent)
      requestBody:
        content:
            application/json:
                schema:
                    type: object
                    properties:
                        childEmail: { type: string }
      responses:
        200:
            description: Child linked
  /portal/my-grades:
    get:
      tags: [Portal (Student)]
      summary: Get My Grades (Student)
      responses:
        200:
            description: Grade list
  /portal/child/{childId}/grades:
    get:
      tags: [Portal (Parent)]
      summary: Get Grades for Child (Parent)
      parameters:
        - in: path
          name: childId
          required: true
          schema:
            type: string
      responses:
        200:
          description: Child Grade list
  /portal/history:
    get:
      tags: [Portal]
      summary: Get Grade History
      responses:
        200:
           description: History
  /portal/bulletins:
    get:
      tags: [Portal]
      summary: Get My Bulletins
      responses:
        200:
           description: Bulletins List
